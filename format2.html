<html>
<head></head>
<body>
	

<script>
/*
* 请将html添加到body中
* 如：
* var div = document.createElement("div");
* div.textContent = "我将被添加到body中";
* body.appendChild(div);
* ***********jQuery写法*********
* $(body).append("<div>我将被添加到body中</div>");
*/
var body = global.body;
//保存echarts图形对象
var chart = null;
//判断是否设置横竖屏有变动
var hasorientationchange = false;
//外部参数，如筛选器，联动参数，形如：[{name:'age',value:23}]
var params = global.params;

var sData = { //显示的数据
	"name": '', // 标题
	"num": 0, // 完成值
}
var max = 0 // 计划值

/**
* 渲染图形
*/
function renderChart(data){
	sData = { //显示的数据
		"name": data.c0[0],
		"num": data.c2[0]
	}
	max = data.c1[0] //最大数值
	chart.setOption({
		angleAxis: {
			show: false,
			// max: max * 3 / 2, //这里将极坐标最大值转换成仪表盘的最大值，(360度除以240度)
			max: max * 2 / 1, //这里将极坐标最大值转换成仪表盘的最大值，(360度除以240度)
			type: 'value',
			startAngle: 180, //极坐标初始角度，从第一象限算起，大约在7-8点钟角度之间
			endAngle: 0,
			splitLine: {
				show: false //隐藏坐标
			}
		},
		barMaxWidth: 18, //圆环宽度
		radiusAxis: { //隐藏坐标
			show: false,
			type: 'category',
		},
		polar: { //设置圆环位置和大小
			center: ['50%', '50%'],
			radius: '296'
		},
		series: [
			{
				type: 'bar',
				data: [{ //上层圆环，用于显示真实数据
					value: sData.num,
					itemStyle: {
						color: { //图形渐变颜色方法，四个数字分别代表，右，下，左，上，offset表示0%到100%
							type: 'linear',
							x: 0,
							y: 0,
							x2: 1, //从左到右 0-1
							y2: 0,
							colorStops: [{
								offset: 0,
								// color: '#CD48AE' // 0% 处的颜色
								color: '#0061ff' // 0% 处的颜色 [0].#0061ff [1].#4bd867 [2].#0a3b6d
							}, {
								offset: 1,
								// color: '#2CABFC' // 100% 处的颜色
								color: '#03fcff' // 100% 处的颜色 [0].#03fcff [1].#f1e67b [2].#06ff81
							}],
							globalCoord: false // 缺省为 false
						},
						shadowColor: 'rgba(255, 255, 255, 0.2)', //加白色阴影产生高亮效果
						shadowBlur: 10
					}
				}],
				barGap: '-100%', //柱间距离,用来将上下两层圆环重合
				coordinateSystem: 'polar', //类型，极坐标
				roundCap: true, //顶端圆角
				z: 2 //圆环层级，和zindex相似
			}, { //下层圆环，用于显示最大值
				type: 'bar',
				data: [{
					value: max,
					itemStyle: {
						color: '#193791', // 背景色
						shadowColor: 'rgba(0, 0, 0, 0.2)', //加白色阴影产生高亮效果
						shadowBlur: 5,
						shadowOffsetY: 2
					}
				}],
				barGap: '-100%', //柱间距离,用来将上下两层圆环重合
				coordinateSystem: 'polar', //类型，极坐标
				roundCap: true, //顶端圆角
				z: 1 //圆环层级，和zindex相似
			},
			{ //仪表盘
				type: 'gauge',
				radius: '66%', // 调整数值改变刻度圈大小
				startAngle: 180, //起始角度，同极坐标
				endAngle: 0, //终止角度，同极坐标
				max: max,
				splitNumber: 5, //分割线个数（除原点外）
				axisLine: { // 坐标轴线
					show: false
				},
				pointer: {
					show: false
				},
				axisLabel: {
					// 坐标轴数字
					show: false,
					textStyle: {
						fontSize: 8,
						color: "#13B5FC"
					},
				},
				axisTick: { // 坐标轴标记
					length: 10,
					lineStyle: {
						color: "#13B5FC"
					}
				},
				splitLine: { // 分隔线
					length: 5,
					lineStyle: {
						width: 1,
					}
				},
				title: { //标题，显示仪表盘标题
					textStyle: {
						color: '#fff',
						shadowColor: '#fff',
						fontSize: 34
					},
					offsetCenter: ["0", '25%'] //位置偏移
				},
				detail: { //仪表盘数值
					formatter: function (params) {
						var name = sData.name.toString()
						var list = ''
						for (var i = 0; i < name.length; i++) {
							list += '{value|' + name[i] + '}' //每个数字用border隔开
							if (i !== name.length - 1) {
								list += '{margin|}' //添加margin值
							}
						}
						return [list]
					},
					offsetCenter: ["0", '-30%'],
					rich: { //编辑富文本样式
						value: {
							// width: 24,
							// height: 42,
							// borderColor: '#02A0F0',
							// borderWidth: 2,
							// borderRadius: 5,
							lineHeight: 1000,
							fontSize: 50,
							fontWeight: 'bold',
							// padding: [0, 0, 4, 0],
							color: '#2ddeff',
							// shadowColor: 'rgb(2,157,239)',
							// shadowBlur: 5
						},
						margin: {
							width: 8,
							height: 42,
						}
					}

				},
				data: [{
					value: sData.num,
					//value: data.c0[0],
					name: sData.name,
					//name: data.c0[0]
				}]
			}
		]
	})
}
/**
 * 初始化节点数据时触发
* @param {Object} data
*/
global.init = function(data) {
	sData = { //显示的数据
		"name": data.c0[0],
		"num": data.c2[0]
	}
	max = data.c1[0] //最大数值
	chart = echarts.init(body.querySelector("#echarts"));
	renderChart(data);
	//对外发起联动
	// chart.on('click', function(param){
	//      global.postMessage({
	//         type:'connect',
	//          data : {columnName:'c0',value:param.name}
	//      });
	// })
}

/**
 * 更新节点数据时触发
 * @param {Object} data
 * @param {Object} param 联动筛选的数据
 */
global.update = function(data, param) {
	renderChart(data);
}

/**
 * 窗口大小改变的时候触发
* @param {Event} e
*/
global.resize = function(e) {
   //如果横竖屏有变动，则不需要再resize事件中调整图形大小
	if(!hasorientationchange){
	   chart.resize();
	}
	hasorientationchange = false;
}

/**
 * 设备横屏竖屏切换时触发
 * @param {Object} e
 */
global.orientationchange = function(e) {
   chart.resize();
   hasorientationchange = true;
}
</script>

</body>
</html>