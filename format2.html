<html>
<head></head>
<body>
	

<script>
/*
* 请将html添加到body中
* 如：
* var div = document.createElement("div");
* div.textContent = "我将被添加到body中";
* body.appendChild(div);
* ***********jQuery写法*********
* $(body).append("<div>我将被添加到body中</div>");
*/
var body = global.body;
//保存echarts图形对象
var chart = null;
//判断是否设置横竖屏有变动
var hasorientationchange = false;
//外部参数，如筛选器，联动参数，形如：[{name:'age',value:23}]
var params = global.params;

/**
* 渲染图形
*/
var c0 = data.c0;
var c1 = data.c1;
var c2 = data.c2;
function ndzc(data) {
	// 新数组
	var headArr = [];
	headArr = [...new Set(c0)]; // 原数组去重
	console.log("headArr:::", headArr);
	
	// 遍历c0，打出类型
	var str = '<div class="ndzc">';
	for(var i = 0; i < headArr.length; i++) {
		str += '<div class="zc-box">';
		str += '<div class="zc-name name-zc">' + headArr[i] + '</div>';
		str += '<div class="zc-items" id="box'+ i +'">';
		str += '</div>';
		str += '</div>';
	}
	str += '</div>';
	// console.log(str)
	$("#echarts").append(str);
	
	// 遍历c1，寻找对应父级打出
	for(var j=0; j<c1.length; j++) {
		var index = headArr.indexOf(c0[j]);
		console.log("index", index);
		var subStr = '' 
		switch(c2[j]) {
			case "转场完成":
				subStr += '<div class="item item-zc">';
				break;
			case "铅封完成":
				subStr += '<div class="item item-qf">';
				break;
			case "未完成":
				subStr += '<div class="item item-wwc">';
				break;
		};
		subStr += c1[j] + '</div>';
		subStr += '<div class="zc-arr zc-arr-wwc"></div>';
		console.log(typeof(subStr));
		console.log("subStr", subStr);
		$("#box"+index).append(subStr);
		// $("#echarts").append(subStr);
		console.log("---------------------------");
		// $(".zc-box")[index].find(".zc-items").append(subStr)
		
	}
	
}

/**
 * 初始化节点数据时触发
* @param {Object} data
*/

global.init = function(data) {
	
	//chart = echarts.init(body.querySelector("#echarts"));
	console.log(1111111111)
	$.when(
		$.getScript('./js/world-gl-map/d3-contour.js'),
		$.getScript('./js/world-gl-map/d3_geo.js'),
		$.getScript('./js/world-gl-map/d3_timer.js')
	// ).done(drawEarth());
	).done(makeData2(data));
	console.log(22222222222222);
	
	// makeDatas(data)
	// renderChart(data);
	//对外发起联动
	chart.on('click', function(param){
		 global.postMessage({
			type:'connect',
			 data : {columnName:'c0',value:param.name}
		 });
	})
}

/**
 * 更新节点数据时触发
 * @param {Object} data
 * @param {Object} param 联动筛选的数据
 */
global.update = function(data, param) {
	//renderChart(data);
	$.when(
		$.getScript('./js/world-gl-map/d3-contour.js'),
		$.getScript('./js/world-gl-map/d3_geo.js'),
		$.getScript('./js/world-gl-map/d3_timer.js')
	// ).done(drawEarth());
	).done(makeData(data));
}

/**
 * 窗口大小改变的时候触发
* @param {Event} e
*/
global.resize = function(e) {
   //如果横竖屏有变动，则不需要再resize事件中调整图形大小
	if(!hasorientationchange){
	   chart.resize();
	}
	hasorientationchange = false;
}

/**
 * 设备横屏竖屏切换时触发
 * @param {Object} e
 */
global.orientationchange = function(e) {
   chart.resize();
   hasorientationchange = true;
}
</script>

</body>
</html>